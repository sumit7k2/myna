# Expo + TypeScript Starter (SDK 51)

This repo bootstraps an Expo SDK 51 app with TypeScript and foundational tooling.

## Features

- TypeScript with strict tsconfig
- React Navigation (Native Stack + Bottom Tabs)
- Tamagui UI with light/dark themes
- Data: Apollo GraphQL, TanStack Query, Zustand + MMKV persistence
- Expo modules: Image, Image Picker, File System, Secure Store, Notifications (stub)
- MSW GraphQL mocks toggled by env (`USE_MOCKS`)
- Sentry (sentry-expo)
- DevX: ESLint, Prettier, Husky + lint-staged, Jest + RTL, Detox scaffold
- CI/CD: EAS config and GitHub Actions workflow skeleton

## Getting started

1. Prerequisites: Node 18+, pnpm/npm, Expo CLI (`npm i -g expo`), EAS CLI (`npm i -g eas-cli`) if you plan to build.
2. Install deps:

```bash
npm install
```

3. Configure environment:

Create `.env` from the example and adjust values.

```bash
cp .env.example .env
```

Env variables consumed by the app (via `app.config.ts` -> `Constants.expoConfig.extra`):

- `USE_MOCKS` ("true" | "false") — start MSW GraphQL mocks in development/web
- `GRAPHQL_ENDPOINT` — your GraphQL endpoint
- `SENTRY_DSN` — Sentry DSN (optional; when empty, Sentry is disabled)
- `SENTRY_TRACES_SAMPLE_RATE` — Sentry traces sample rate (e.g. 0.2)
- `SENTRY_PROFILES_SAMPLE_RATE` — Sentry profiles sample rate (e.g. 0.1)
- `EAS_PROJECT_ID` — EAS project id
- `SENTRY_ORG`, `SENTRY_PROJECT` — for the sentry-expo config plugin

4. Run the app:

```bash
# start metro/dev server
npm run dev

# run platform
npm run ios
npm run android
npm run web
```

## Scripts

- `dev` — expo start
- `lint` — ESLint
- `type-check` — TypeScript noEmit check
- `test` — Jest + RTL
- `codegen` — GraphQL Code Generator (using `codegen.ts`)
- `build:ios` / `build:android` — EAS build preview profile

## Project structure

- `app.config.ts` — Expo config with `extra` env values
- `src/` — source
  - `features/` — screens (Home, Topics, Compose, Notifications, Profile, PostDetail, Settings)
  - `navigation/` — navigator setup
  - `lib/` — apollo, query client, storage, env, sentry, notifications
  - `state/` — Zustand stores
  - `graphql/` — local contract schema and shared fragments (for codegen)
  - `lib/gql/` — GraphQL Codegen output (generated types and Apollo React hooks)
  - `mocks/` — MSW GraphQL mocks
  - `test/` — unit tests
- `assets/` — icons/splash and media
- `scripts/` — place your scripts here

## MSW mocks

Offline-first development is enabled by default via MSW GraphQL mocks.

- USE_MOCKS defaults to true in development and test, and can be overridden in `.env`.
- Web uses msw/browser; Native (Expo) uses msw/native; Jest leverages msw/node; Detox leverages the native server.
- See docs/mocks.md for details, scenarios, and test helpers.

## GraphQL + Codegen

This project uses Apollo Client with typed hooks generated by GraphQL Code Generator.

- Colocate your GraphQL `.graphql` operation files under `src/features/**` (or anywhere in `src/`).
- Shared fragments live in `src/graphql/fragments.graphql`.
- The local contract schema (used for codegen and MSW mocks) is at `src/graphql/schema.graphql`.
- Generated output goes to `src/lib/gql/generated.ts`.

Run codegen any time you add or change operations:

```bash
npm run codegen
```

Tips:
- Name your operations (e.g. `query GetFeed`, `mutation LikePost`) so MSW can target them easily.
- Use the shared fragments to keep fields consistent across features.

## Sentry

This app integrates Sentry via `sentry-expo` with React Navigation routing instrumentation and performance tracing.

- Enable by setting `SENTRY_DSN` in your `.env` (or project secrets). If `SENTRY_DSN` is empty or unset, Sentry stays completely disabled and safe no-ops are used.
- Performance: `tracesSampleRate` defaults to 1.0 in development. You can override with `SENTRY_TRACES_SAMPLE_RATE` and enable profiling via `SENTRY_PROFILES_SAMPLE_RATE`.
- Navigation: The root navigator registers Sentry's React Navigation instrumentation to capture route transitions as spans.
- Config plugin: The `sentry-expo` config plugin is included in `app.config.ts` and uses `SENTRY_ORG` and `SENTRY_PROJECT` if provided.

Testing:
- Jest stubs Sentry in `jest.setup.ts` to avoid any network calls. CI is configured to run with `SENTRY_DSN` empty.

Troubleshooting:
- If you see build-time Sentry errors, ensure `SENTRY_ORG`/`SENTRY_PROJECT` are set when building with EAS, or leave them empty for local dev.
- If performance spans are missing, check that `SENTRY_DSN` is set and that `SENTRY_TRACES_SAMPLE_RATE` is > 0.

## Testing

- Unit: `npm test`
- E2E: Detox scaffold is provided, but no build pipeline is configured by default.

## CI/CD

- `eas.json` defines preview build profile
- `.github/workflows/ci.yml` lint + type-check + tests + Expo build preview (skeleton)

